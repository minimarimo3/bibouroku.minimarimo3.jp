<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Typstでブログを書く</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;family=Noto+Serif+JP:wght@400;700&amp;display=swap">
    <script src="/script.js">
    </script>
    <link rel="stylesheet" href="/style.css">
    <meta name="description" content="Typst v0.14の新機能を使って、Typstだけでブログシステムを構築する試み。">
    <meta property="og:title" content="Typstでブログを書く">
    <div class="raw-html-embed" data-html="<!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{&quot;token&quot;: &quot;4b32234cfe9741ea8a4437f109f7b029&quot;}'></script><!-- End Cloudflare Web Analytics -->"></div>
  </head>
  <body>
    <div class="site-container">
      <main class="main-content">
        <article>
          <header class="article-header">
            <p><a class="back-home-btn" href="/">← ホームに戻る</a></p>
            <h1 class="article-title">Typstでブログを書く</h1>
            <div class="article-meta">
              <div class="meta-dates"><span class="meta-date">文書作成日: 25-12-14</span><span class="meta-date">最終更新日: 25-12-15</span></div>
              <div class="meta-tags"><span class="tag">#Typst</span><span class="tag">#HTML</span></div>
            </div>
          </header>
          <div class="mobile-toc"><details><summary>目次を開く</summary><nav role="doc-toc"><ol style="list-style-type: none"><li><a href="#はじめに"><span class="prefix">1.</span> はじめに</a></li><li><a href="#loc-2"><span class="prefix">2.</span> ファイル構成</a></li><li><div><a href="#loc-3"><span class="prefix">3.</span> 実装</a></div><ol style="list-style-type: none"><li><a href="#loc-4"><span class="prefix">3.1.</span> <code>html.html</code>で出力されるHTMLの構造をカスタマイズ</a></li><li><a href="#loc-5"><span class="prefix">3.2.</span> 関連記事のランダム生成</a></li><li><div><a href="#loc-6"><span class="prefix">3.3.</span> 未実装機能への対処</a></div><ol style="list-style-type: none"><li><a href="#loc-7"><span class="prefix">3.3.1.</span> 数式(Math)をSVG化して埋め込む</a></li><li><a href="#loc-8"><span class="prefix">3.3.2.</span> カスタムHTML構造での注釈(Footnote)</a></li></ol></li><li><a href="#loc-9"><span class="prefix">3.4.</span> GitHub Actionsを作成しGitHub Pagesで公開する</a></li></ol></li><li><a href="#loc-10">参考文献</a></li></ol></nav></details></div>
          <div class="article-abstract">
            <p><strong class="abstract-title">概要</strong></p>
            <p>Typst v0.14の新機能を使って、Typstだけでブログシステムを構築する試み。</p>
          </div>
          <div class="article-body">
            <div class="markdown-alert markdown-alert-note">
              <p class="markdown-alert-title"><span class="markdown-alert-icon">ℹ️</span>補足</p>
              <div class="markdown-alert-content">この記事は<a href="https://qiita.com/advent-calendar/2025/typst">Typst Advent Calender 2025</a>のTODO日目の記事です。</div>
            </div>
            <h2>執筆環境</h2>
            <table>
              <thead>
                <tr>
                  <th>ソフト名</th>
                  <th>バージョン</th>
                  <th>補足</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Typst</td>
                  <td>0.14</td>
                  <td>TYPST_FEATURES=html</td>
                </tr>
                <tr>
                  <td>Tinymist Typst</td>
                  <td>0.14.4</td>
                  <td>—</td>
                </tr>
              </tbody>
            </table>
            <h2 id="はじめに">1. はじめに</h2>
            <p>Typst、とてもいいですよね。 Markdownのような書き心地でfigureやfootnoteや参考文献への参照等が書けるためとても気に入っています。</p>
            <p>そのTypstですがバージョン0.14でHTMLエクスポート機能が大幅に強化されました。 なんとほとんど<span class="footnote-wrapper"><span class="footnote-marker">※0</span><span class="footnote-content">例えばカスタムHTML内でのfootnoteなどはまだ使えません</span></span>の<a href="https://typst.app/docs/reference/model/">セマンティック要素(Modelカテゴリの要素)</a>がHTMLとして適切に変換できるようになり<a id="loc-1" href="#loc-11" role="doc-biblioref">[1]</a>、また、<code>html.elem</code>を使用して任意のHTMLタグをTypstから生成できるようになりました。 これによりTypstはHTMLのDOMツリーを直接操作できるようになりました。</p>
            <p>そんなわけで実際にTypstだけで記述可能なブログシステムを作ってみました。 SSG(Static Site Generator)のようなものを構築したのですが、記事の記述等々をTypst内部だけで完結させた点が面白かったのでその裏側を紹介します。</p>
            <p>なお、スクリプトはWTFPLで公開しているものの、個人用に作ったものであるため他人が使うことを想定していません。 現時点でもここまでできるんだよということを紹介するためのものとして受け取ってもらいたいです。</p>
            <h2 id="loc-2">2. ファイル構成</h2>
            <p>ファイル構成は<a href="#ファイル構成">コード 1</a>のようになっています。</p>
            <figure id="ファイル構成">
              <pre><code data-lang="sh"><span style="color: #4b69c6">BIBOUROKU.MINIMARIMO3.JP</span><br><span style="color: #4b69c6">│</span>  index.typ      <span style="color: #74747c">#</span><span style="color: #74747c"> トップページ</span><br><span style="color: #4b69c6">│</span>  style.css      <span style="color: #74747c">#</span><span style="color: #74747c"> サイトのスタイルシート</span><br><span style="color: #4b69c6">│</span>  posts.typ      <span style="color: #74747c">#</span><span style="color: #74747c"> 公開対象の記事のメタデータを記述するファイル</span><br><span style="color: #4b69c6">│</span>  template.typ   <span style="color: #74747c">#</span><span style="color: #74747c"> 記事のテンプレート</span><br><span style="color: #4b69c6">│</span>  build.py       <span style="color: #74747c">#</span><span style="color: #74747c"> posts.typのデータをもとにディレクトリを走査し、ビルドと添付ファイルの移動を行うスクリプト</span><br><span style="color: #4b69c6">│</span><br><span style="color: #4b69c6">├─public          </span><span style="color: #74747c">#</span><span style="color: #74747c"> ビルド後の出力先</span><br><span style="color: #4b69c6">│</span>  │  index.html<br><span style="color: #4b69c6">│</span>  │  style.css<br><span style="color: #4b69c6">│</span>  │  feed.xml    <span style="color: #74747c">#</span><span style="color: #74747c"> build.pyによって生成されます</span><br><span style="color: #4b69c6">│</span>  │  sitemap.xml <span style="color: #74747c">#</span><span style="color: #74747c"> build.pyによって生成されます</span><br><span style="color: #4b69c6">│</span>  │<br><span style="color: #4b69c6">│</span>  ├─Typstでブログを書く<br><span style="color: #4b69c6">│</span>  │      index.html<br><span style="color: #4b69c6">│</span>  │      index.pdf<br><span style="color: #4b69c6">│</span>  │<br><span style="color: #4b69c6">│</span>  └─テスト<br><span style="color: #4b69c6">│</span>          index.html<br><span style="color: #4b69c6">│</span>          index.pdf<br><span style="color: #4b69c6">│</span>          テスト用画像.png<br><span style="color: #4b69c6">│</span><br><span style="color: #4b69c6">├─Typstでブログを書く </span><span style="color: #74747c">#</span><span style="color: #74747c"> 記事1</span><br><span style="color: #4b69c6">│</span>      index.pdf<br><span style="color: #4b69c6">│</span>      index.typ<br><span style="color: #4b69c6">│</span>      Typstでブログを書く.yaml<br><span style="color: #4b69c6">│</span><br><span style="color: #4b69c6">├─テスト             </span><span style="color: #74747c">#</span><span style="color: #74747c"> 記事2</span><br><span style="color: #4b69c6">│</span>      index.pdf<br><span style="color: #4b69c6">│</span>      index.typ<br><span style="color: #4b69c6">│</span>      reference.bib<br><span style="color: #4b69c6">│</span>      テスト用画像.png<br><span style="color: #4b69c6">│</span><br><span style="color: #4b69c6">└─.github</span><br>  <span style="color: #4b69c6">└─workflows</span><br>          <span style="color: #4b69c6">deploy.yml</span></code></pre>
              <figcaption>コード 1: 当ブログのファイル構成</figcaption>
            </figure>
            <h2 id="loc-3">3. 実装</h2>
            <h3 id="loc-4">3.1. <code>html.html</code>で出力されるHTMLの構造をカスタマイズ</h3>
            <p><code>html.html</code>や<code>html.head</code>を使用せずにHTMLエクスポートすると、文書の内容はすべてbodyタグ内に記述されることになります。 これは<code>html.style</code>や<code>html.meta</code>であってもbodyタグ内に記述されるということです。 headに記述したい内容がある場合は<code>html.html</code>を使用してエクスポートするHTMLの構造を一から記述する必要があるみたいです。</p>
            <p>今回のブログでは、<code>template.typ</code>内に以下のような構造を定義しました。</p>
            <pre><code data-lang="typc">html.<span style="color: #4b69c6">html</span>(lang: <span style="color: #198810">"ja"</span>, {<br>  html.<span style="color: #4b69c6">head</span>({<br>    html.<span style="color: #4b69c6">meta</span>(charset: <span style="color: #198810">"utf-8"</span>)<br>    html.<span style="color: #4b69c6">meta</span>(name: <span style="color: #198810">"viewport"</span>, content: <span style="color: #198810">"width=device-width, initial-scale=1"</span>)<br>    html.<span style="color: #4b69c6">title</span>(title)<br>    <br>    <span style="color: #74747c">// OGP設定やGoogle Fontsの読み込み</span><br>    <span style="color: #d73948">if</span> description <span style="color: #d73948">!=</span> <span style="color: #198810">""</span> {<br>      html.<span style="color: #4b69c6">meta</span>(name: <span style="color: #198810">"description"</span>, content: description)<br>    }<br>    html.<span style="color: #4b69c6">elem</span>(<span style="color: #198810">"meta"</span>, attrs: (property: <span style="color: #198810">"og:title"</span>, content: title))<br>    html.<span style="color: #4b69c6">link</span>(rel: <span style="color: #198810">"stylesheet"</span>, href: <span style="color: #198810">"/style.css"</span>)<br>    html.<span style="color: #4b69c6">link</span>(rel: <span style="color: #198810">"preconnect"</span>, href: <span style="color: #198810">"https://fonts.googleapis.com"</span>)<br>    html.<span style="color: #4b69c6">link</span>(rel: <span style="color: #198810">"preconnect"</span>, href: <span style="color: #198810">"https://fonts.gstatic.com"</span>, crossorigin: <span style="color: #198810">"anonymous"</span>)<br>    <br>    html.<span style="color: #4b69c6">script</span>(src: <span style="color: #198810">"/script.js"</span>)<br>    html.<span style="color: #4b69c6">link</span>(rel: <span style="color: #198810">"stylesheet"</span>, href: <span style="color: #198810">"/style.css"</span>)<br>  })<br>  <br>  html.<span style="color: #4b69c6">body</span>({<br>    html.<span style="color: #4b69c6">div</span>(class: <span style="color: #198810">"site-container"</span>, {<br>      <span style="color: #74747c">// ヘッダー、記事本文、サイドバーなどを自由に配置</span><br>      html.<span style="color: #4b69c6">main</span>(class: <span style="color: #198810">"main-content"</span>, body)<br>      html.<span style="color: #4b69c6">aside</span>(class: <span style="color: #198810">"sidebar"</span>, { ... })<br>    })<br>  })<br>})</code></pre>
            <h3 id="loc-5">3.2. 関連記事のランダム生成</h3>
            <p>外部スクリプトで計算した結果を渡すのではなく、Typst内部で乱数を生成して記事を選んでいます。 ただし、ビルドのたびに関連記事が変わるのは困るので記事タイトルのハッシュ地をシードにして乱数を固定しています。</p>
            <pre><code data-lang="typc"><span style="color: #74747c">// template.typより抜粋</span><br>#<span style="color: #d73948">import</span> <span style="color: #198810">"@preview/suiji:0.5.0"</span>: <span style="color: #d73948">*</span><br><br><span style="color: #74747c">// 記事タイトルを数値化してシードにする</span><br><span style="color: #d73948">let</span> seed <span style="color: #d73948">=</span> <span style="color: #4b69c6">int</span>(title.<span style="color: #4b69c6">clusters</span>().<span style="color: #4b69c6">map</span>(str.to-unicode).<span style="color: #4b69c6">map</span>(str).<span style="color: #4b69c6">join</span>().<span style="color: #4b69c6">slice</span>(<span style="color: #b60157">0</span>, <span style="color: #b60157">14</span>))<br><span style="color: #d73948">let</span> rng <span style="color: #d73948">=</span> <span style="color: #4b69c6">gen-rng</span>(seed)<br><br><span style="color: #74747c">// 記事リストをシャッフル</span><br><span style="color: #d73948">let</span> (_, indices) <span style="color: #d73948">=</span> <span style="color: #4b69c6">shuffle-f</span>(rng, <span style="color: #4b69c6">range</span>(other-posts.<span style="color: #4b69c6">len</span>()))<br><br><span style="color: #74747c">// 上位3件を取得</span><br><span style="color: #d73948">let</span> picks <span style="color: #d73948">=</span> indices.<span style="color: #4b69c6">slice</span>(<span style="color: #b60157">0</span>, <span style="color: #b60157">3</span>).<span style="color: #4b69c6">map</span>(i <span style="color: #d73948">=></span> other-posts.<span style="color: #4b69c6">at</span>(i))</code></pre>
            <h3 id="loc-6">3.3. 未実装機能への対処</h3>
            <h4 id="loc-7">3.3.1. 数式(Math)をSVG化して埋め込む</h4>
            <p>現状、数式のHTMLエクスポートは未実装（または不完全）です。 そこで、数式を html.frame で一度フレーム（画像的な扱い）にし、SVGとしてHTML内に展開することで表示させました。</p>
            <pre><code data-lang="typc"><span style="color: #d73948">show</span> math.equation.<span style="color: #4b69c6">where</span>(block: <span style="color: #d73948">false</span>): it <span style="color: #d73948">=></span> {<br>  html.<span style="color: #4b69c6">elem</span>(<span style="color: #198810">"span"</span>, attrs: (role: <span style="color: #198810">"math"</span>), html.<span style="color: #4b69c6">frame</span>(it))<br>}<br><span style="color: #d73948">show</span> math.equation.<span style="color: #4b69c6">where</span>(block: <span style="color: #d73948">true</span>): it <span style="color: #d73948">=></span> {<br>  html.<span style="color: #4b69c6">elem</span>(<span style="color: #198810">"figure"</span>, attrs: (role: <span style="color: #198810">"math"</span>), html.<span style="color: #4b69c6">frame</span>(it))<br>}</code></pre>
            <h4 id="loc-8">3.3.2. カスタムHTML構造での注釈(Footnote)</h4>
            <p><code>html.html</code>を使ってカスタム構造を作ると、標準の <code data-lang="typc">footnote</code> がエラーになります。</p>
            <pre><code>error: footnotes are not currently supported in combination with a custom `&lt;html>` or `&lt;body>` element<br>   ┌─ \\?\G:\マイドライブ\bibouroku.minimarimo3.jp\テスト\index.typ:97:16<br>   │<br>97 │ これがノートを付けられる対象1#footnote[footnoteの中身1]<br>   │                               ^^^^^^^^^^^^^^^^^^^^^^^^^<br>   │<br>   = hint: you can still use footnotes with a custom footnote show rule</code></pre>
            <p>幸いcounterは使えるので自分で実装することで対処することができます。</p>
            <pre><code data-lang="typc"><span style="color: #d73948">let</span> note-counter <span style="color: #d73948">=</span> <span style="color: #4b69c6">counter</span>(<span style="color: #198810">"my-footnote"</span>)<br><span style="color: #d73948">show</span> <span style="color: #4b69c6">footnote</span>: it <span style="color: #d73948">=></span> {<br>  note-counter.<span style="color: #4b69c6">step</span>()<br>  <span style="color: #d73948">let</span> num <span style="color: #d73948">=</span> note-counter.<span style="color: #4b69c6">get</span>().<span style="color: #4b69c6">first</span>()<br>  <span style="color: #74747c">// CSSでツールチップ表示するためのHTML構造を出力</span><br>  html.<span style="color: #4b69c6">span</span>(class: <span style="color: #198810">"footnote-wrapper"</span>, {<br>    html.<span style="color: #4b69c6">span</span>(class: <span style="color: #198810">"footnote-marker"</span>, <span style="color: #198810">"※"</span> <span style="color: #d73948">+</span> <span style="color: #4b69c6">str</span>(num))<br>    html.<span style="color: #4b69c6">span</span>(class: <span style="color: #198810">"footnote-content"</span>, it.body)<br>  })<br>}</code></pre>
            <h3 id="loc-9">3.4. GitHub Actionsを作成しGitHub Pagesで公開する</h3>
            <p><code>typst compile --features html --format html --root . (ディレクトリ)/index.typ public/(ディレクトリ)/index.html</code></p>
            <p>でおｋ！</p>
            <section role="doc-bibliography">
              <h2 id="loc-10">参考文献</h2>
              <ul style="list-style-type: none">
                <li id="loc-11"><span class="prefix"><a href="#loc-1" role="doc-backlink">[1]</a></span> L. Mädje と M. Haug, 「Typst: Typst 0.14: Now accessible – Typst Blog」, Typst. 参照: 2025年12月19日. [Online]. 入手先: <a href="https://typst.app/blog/2025/typst-0.14#richer-html-export:~:text=Most%20semantic%20elements%20(those%20from%20the%20Model%20category)%20are%20now%20properly%20mapped%20to%20semantic%20HTML.%20We%27ve%20also%20improved%20handling%20of%20textual%20content%20in%20HTML%20export.">https://typst.app/blog/2025/typst-0.14#richer-html-export:~:text=Most%20semantic%20elements%20(those%20from%20the%20Model%20category)%20are%20now%20properly%20mapped%20to%20semantic%20HTML.%20We%27ve%20also%20improved%20handling%20of%20textual%20content%20in%20HTML%20export.</a></li>
              </ul>
            </section>
          </div>
        </article>
        <section class="share-feedback-section">
          <hr class="section-divider">
          <div class="share-area">
            <h3>この記事をシェアする</h3>
            <div class="share-buttons"><button class="share-btn btn-x" onclick="shareX()">Xでポスト</button><button class="share-btn btn-misskey" onclick="shareMisskey()">Misskeyでノート</button><button class="share-btn btn-copy" onclick="copyInfo()">タイトルと概要をコピー</button></div>
          </div>
          <div class="feedback-area">
            <h3>ご意見・ご感想</h3>
            <p>記事に関するご意見や誤字の報告などをお待ちしています。</p>
            <button class="feedback-link" onclick="openFeedback('https://docs.google.com/forms/d/e/1FAIpQLSdyN8Q-zohUmlOxASKnJjwSSgs-S0PkHZMXDg2Zh8GgSTgOkQ/viewform', 'entry.629693238')">Googleフォームで送る</button>
          </div>
        </section>
        <hr class="section-divider">
        <section class="related-posts">
          <h2 class="section-title">その他の記事</h2>
          <div class="card-grid"><a class="post-card" href="/テスト/"><div class="card-content"><p><time class="card-date">25-12-12</time></p><h3 class="card-title">テスト</h3><p class="card-desc">サイトの表示テスト</p></div></a></div>
        </section>
      </main>
      <aside class="sidebar">
        <div class="sidebar-inner">
          <div class="sidebar-widget toc-widget">
            <h3 class="widget-title">目次</h3>
            <nav role="doc-toc">
              <ol style="list-style-type: none">
                <li><a href="#はじめに"><span class="prefix">1.</span> はじめに</a></li>
                <li><a href="#loc-2"><span class="prefix">2.</span> ファイル構成</a></li>
                <li>
                  <div><a href="#loc-3"><span class="prefix">3.</span> 実装</a></div>
                  <ol style="list-style-type: none">
                    <li><a href="#loc-4"><span class="prefix">3.1.</span> <code>html.html</code>で出力されるHTMLの構造をカスタマイズ</a></li>
                    <li><a href="#loc-5"><span class="prefix">3.2.</span> 関連記事のランダム生成</a></li>
                    <li>
                      <div><a href="#loc-6"><span class="prefix">3.3.</span> 未実装機能への対処</a></div>
                      <ol style="list-style-type: none">
                        <li><a href="#loc-7"><span class="prefix">3.3.1.</span> 数式(Math)をSVG化して埋め込む</a></li>
                        <li><a href="#loc-8"><span class="prefix">3.3.2.</span> カスタムHTML構造での注釈(Footnote)</a></li>
                      </ol>
                    </li>
                    <li><a href="#loc-9"><span class="prefix">3.4.</span> GitHub Actionsを作成しGitHub Pagesで公開する</a></li>
                  </ol>
                </li>
                <li><a href="#loc-10">参考文献</a></li>
              </ol>
            </nav>
          </div>
          <div class="sidebar-widget">
            <h3 class="widget-title">Author</h3>
            <p><strong>minimarimo3</strong></p>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5em;">Typstが好きです。</p>
          </div>
        </div>
      </aside>
    </div>
  </body>
</html>
